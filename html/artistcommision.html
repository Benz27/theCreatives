<?php
session_start();

include("../php/conn.php");
include("../php/read.php");

$user_data=check_login($link);

?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>theCreatives</title>

    <!-- main css -->
    <link rel="stylesheet" href="../css/artistcomm.css">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">

    <!-- link for animate-->
    <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <!-- link for font awesome -->
    <script src="https://kit.fontawesome.com/9334436048.js" crossorigin="anonymous"></script>



</head>
<body>
    <!-- header -->
    <style>a{text-decoration: none;}</style>
    <header class="header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-2 px-0">
                    <div class="header_logo">
                        <a href="explore.html"><span>the</span>Creatives</a>
                    </div>
                </div>
                <div class="col-lg-10 ">
                    <div class="header_right">
                        <div class="header_right_auth">
                            <a href="explore.html">Home</a>
                            <a href="../html/artists.html">Artists</a>
                            <a href="../php/logout.php" >Log Out</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- profile -->
    <div id="content" class="container p-0">
        <!-- <div class="profile-header">
            <div class="profile-header-cover">
                <img src="../images/white.png" alt="" style="height: 100%;width: 100%;" id="my_image4"/>
              </div>
              <div class="profile-header-content">
                  <div class="profile-header-img">
                    <img src="../images/empty.png" alt="" style="height: 100%;width: 100%;" id="my_image3"/>
                  </div>
                  <div class="profile-header-info">
                      <h4 class="m-t-sm" id="uname"></h4>
                  
                  </div>
              </div>
    
            <ul class="profile-header-tab nav nav-tabs">
                <li class="nav-item"><a id="ar1" href="" class="nav-link" data-toggle="tab">ABOUT</a></li>
                <li class="nav-item"><a id="ar2" href="" class="nav-link" data-toggle="tab">E-PORTFOLIO</a></li>
                <li class="nav-item"><a id="ar3" href="" class="nav-link active show" data-toggle="tab">REQUEST COMMISSION</a></li>
                <li class="nav-item"><a id="ar4" href="" class="nav-link" data-toggle="tab">PRICE LIST</a></li>
            </ul>
            
        </div> -->
        <!-- interface ng profile transaction -->
      <div id="transac">
        
      </div>
    </div>

    <div class="container">
      
        <div class="row">
          
            <div class="col-sm-6">
  
                <!-- <form id="form" action="" method="post"> -->
                    <input type="text" name="artistid" id="artistid" hidden>
                    <input type="text" name="artistuname" id="artistuname" hidden>
                    <input type="text" name="fulln" id="fulln" hidden>
                    
                <label>Art Type</label>
                <input type="text" id="type" name="type" readonly>
                <!-- <select id="type" name="type" required>
                    <option value="" selected="selected" hidden>Select type of art</option>
                </select> -->
            </div>
                <div class="col-sm-6">
                   <label>Art Size</label>
                   <input type="text" id="size" name="size" readonly>
                   <!-- <select id="size" name="size" required>
                      </select> -->
                      
                    </div> 
                    
                    <div class="col-sm-6">      
                      <label>Date Commisioned</label>
                      <!-- <input type="date" id="tgdte" name="date" required> -->
                      <input type="text" id="tartgdte" name="tardate" readonly>
                    </div>

                    <div class="col-sm-6">      
                      <label>Target Date</label>
                      <input type="text" id="tgdte" name="date" required>
                      <input type="text" id="tartgdte" name="tardate" hidden>
                    </div>

                    <div class="col-sm-6">      
                        <label>Base Price</label>
                        <input type="text" id="price" name="" readonly>
                        <input type="text" id="pr" name="price" hidden>
                      </div>
                   

                <label>Commission Details:</label>
                
                <textarea id="addet" style="height:200px" placeholder="Type out specifics here." name="addet" readonly></textarea>
               

                <div class="col-25" id="rp" hidden>
                <label>Reference Picture:</label>
               <input type="text" style="width: 60%;" id="txtsf" value="" name="refpicname" readonly>
                
                </div>
                <div class="piccontainer" id="rpic" hidden>

                    <img src="../images/can.png" alt="empty" style="width:600px;height:300px;position: relative;margin-right: 0px;" id="my_image">
                    <input type="text" name="refpic" id="artwork" value="" hidden> 
                    <input type="file" id = "ifile" hidden>
                </div> 
        
               <hr>
                <div class="row">
                   <label>Commiosioner</label>
                  <div class="col-sm-3">
                   
                    <!-- <input type="text" id="txtsf" value="" name="refpicname" readonly> -->
                    <img src="../images/empty.png" alt="" style="height: 70%;width: 60%;float:right;" id="my_image3"/>
                    <!-- max-height: 70%;max-width: 70%; -->
                  </div>
                  
                  <div class="col-sm-3">
                     <label style="width: 100%;" id="luname">asd</label>
                     <label style="width: 100%;" id="lemail">asd</label>
                    <!-- <input type="text" id="" value="" name="" style="width: 100%;" readonly>
                    <input type="text" id="" value="" name="" style="width: 100%;" readonly> -->
                  </div>
               
                </div>
      
            <div id="paytable">

                 <hr>

            
                  <table class="table">
                      <h5>Payment</h5>
                      <thead>
                        <tr>
                          <th scope="col">#</th>
                          <th scope="col">Reference Number</th>
                          <th scope="col">Proof of Transaction</th>
                          <th scope="col">Type</th>
                        </tr>
                      </thead>
                      <tbody id="tbody">


                        <div id="payrow">




                      </div>


                      </tbody>

                  </table>
            
                 
                  
            </div>



            <div class="row">
          

               
              <label id="lbl"></label>
              <hr>
              <div class="col-25">


                  
                  <button type="button" id="su" onclick="as(2);as(5);" ></button>
                  <button type="button" id="re" onclick="as(3);as(5);" ></button>
                  <button type="button" id="vi" onclick="" hidden><a style="color:black" href="" id="via">View Summary</a></button>
                </div>
            </div>
            <!-- </form> -->
        </div>

      </div>

      <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
          <span class="close">&times;</span>
      
         

          <div class="col-12">
          <label>Reference Number:</label>
          <input type="text" style="width: 40%;" id="txtrnum" value="" name="refpicname" readonly>
        </div>
        <br>
        <div class="col-12">
          <label>Proof of Payment [Optional]:</label>
                      <input type="text" style="width: 50%;" id="txtsfr" value="" name="refpicname" readonly>
                      <br>
          <img id="rimg" src="">
      
          <button id="btnmc" type="button" onclick="span.click();">Close</button>
        </div>
      </div>
      
      </div>
      <!-- <div class="chatcont">
        <div class="row">
          <div>
        <img src="../images/message.png" id="my_image5" height="30px">
        <label id="clabel">Chat with Artist</label>
        </div>
      </div>
      </div> -->

    <!-- js for bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
    
    <script>

        

        var modal = document.getElementById("myModal");

var zx=0;
var imgq;
var xy=0;
var tid=0;
var rcount =0;
var rcnt=0;
var pay=0;
var tpe="PARTIAL";
var span = document.getElementsByClassName("close")[0];


// btn.onclick = function() {
//   modal.style.display = "block";
// }

span.onclick = function() {
  modal.style.display = "none";
  clearr();
}

window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
    clearr();
  }
}


function as(x){

// var today = new Date();
// var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
// // var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds()+":"+today.getUTCMilliseconds();
// var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
// // var dateTime = date+' '+time;
// var dateTime = date;
// document.getElementById("tartgdte").value=dateTime;

var xhttp = new XMLHttpRequest();
    
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {

        if(x==1){

     
          var str=this.responseText;
      
      const arr= str.split("|<~*931>|");

      

      document.getElementById("type").value=arr[2];

      document.getElementById("size").value=arr[3];

      document.getElementById("tartgdte").value=arr[10];
      document.getElementById("tgdte").value=arr[9];
      document.getElementById("price").value="PHP "+arr[4]+".00";

      if(arr[6]!=""){

        document.getElementById("rp").hidden=false;
        document.getElementById("rpic").hidden=false;
        document.getElementById("txtsf").value=arr[7];
        document.getElementById("my_image").setAttribute('src',arr[6]);
      }
      if(arr[18]!=""){

        document.getElementById("my_image3").setAttribute('src',arr[18]);
      }
      document.getElementById("addet").value=arr[5];
          
      document.getElementById("luname").innerHTML="@"+arr[16];
      document.getElementById("lemail").innerHTML=arr[17];



        }
        else if(x==0){
         
        if(this.responseText==""){

          document.getElementById("paytable").hidden=true;

        }else{
          document.getElementById("tbody").innerHTML=this.responseText;
          rcount=0;
          rcnt=0;
        }
         
          // console.log(this.responseText);
        }else if(x==3){




          rcnt=Number(this.responseText);

  

        }else if(x==4){




        if(this.responseText==1){
    

  



        }



        }else if(x==5){


        
          console.log(this.responseText);
      var str2=this.responseText;
      const ar= str2.split(",");
      pay=ar[1];

       switch(Number(ar[0])) {
  case 0:
 
  document.getElementById("su").innerHTML="Accept";
  document.getElementById("re").innerHTML="Reject";
  document.getElementById("su").value=1;
  document.getElementById("re").value=2;
  document.getElementById("lbl").innerHTML="Commision awaiting approval";
  break;
 

  case 2:
  document.getElementById("su").innerHTML="Finish";
  document.getElementById("re").innerHTML="Cancel";
  document.getElementById("su").value=3;
  document.getElementById("re").value=4;
  document.getElementById("lbl").innerHTML="Commision accepted";
  break;




  case 1:
  document.getElementById("lbl").innerHTML="Awaiting payment";
  document.getElementById("su").hidden=true;
    document.getElementById("re").hidden=true;
  break;


  case 3:
  document.getElementById("lbl").innerHTML="Commision rejected";
  document.getElementById("su").hidden=true;
    document.getElementById("re").hidden=true;

  break;

  case 4:
  document.getElementById("lbl").innerHTML="Commision canceled";
  document.getElementById("su").hidden=true;
    document.getElementById("re").hidden=true;

  break;


  case 5:
  document.getElementById("lbl").innerHTML="Commision completed";
  document.getElementById("su").hidden=true;
  document.getElementById("re").hidden=true;
  document.getElementById("vi").hidden=false;
  break;

  default:

        }
        switch(Number(ar[1])) {
        
    // case 0:
          
   
    // break;
    // case 1:
  

    // break;
    case 2:

          
    break;
    default:











        }


        }




      }
     
      }
      var u = window.location.href;
                    var ur = new URL(u);
        var aid = ur.searchParams.get("aid");
        var bid = ur.searchParams.get("bid");
        var cid = ur.searchParams.get("cid");

      if(x==2){

var formdata = new FormData();

if(document.getElementById("su").value==1){

  formdata.append("btn","ACCEPTED");

}else{

  formdata.append("btn","PENDING");


}
formdata.append("val",document.getElementById("su").value);

  xhttp.open("POST", "../php/acomm.php?load="+x+"&cid="+cid+"&bid="+bid+"&aid="+aid, true);
  xhttp.send(formdata);
}else if(x==3){

  var formdata = new FormData();
  if(document.getElementById("re").value==2){

formdata.append("btn","REJECTED");

}else{

formdata.append("btn","CANCELED");


}

formdata.append("val",document.getElementById("re").value);

  xhttp.open("POST", "../php/acomm.php?load="+x+"&cid="+cid+"&bid="+bid+"&aid="+aid, true);
  xhttp.send(formdata);

}else if(x==0||x==3||x==4||x==1||x==5){



  xhttp.open("GET", "../php/acomm.php?load="+x+"&cid="+cid+"&bid="+bid+"&aid="+aid, true);
  xhttp.send();



}




}

function rad(x){

tpe=x;

}


function mod(x,y){
 
  xy=1;
  tid=y;
  modal.style.display = "block";

  document.getElementById("txtrnum").value=document.getElementById(y+"rnum").innerHTML;
  document.getElementById("txtsfr").value=document.getElementById(y).innerHTML;
  document.getElementById("rimg").setAttribute('src',x);

  

}


function clearr(){
  xy=0;
  document.getElementById("txtrnum").value="";
  document.getElementById("txtsfr").value="";
  document.getElementById("rimg").setAttribute('src',"");



}


        var u = window.location.href;
        var ur = new URL(u);
        var l = ur.searchParams.get("artist");

        // document.getElementById("ar1").href="artistabout.html?artist="+l;
        // document.getElementById("ar2").href="artisteport.html?artist="+l;
        // document.getElementById("ar3").href="reqcomm.html?artist="+l;
        // document.getElementById("ar4").href="artistprice.html?artist="+l;


       window.addEventListener('load', function(event){
                        // loadinput();
                        // loadDoc();
as(0);
as(1);
as(5);
as(4);   
               
var u = window.location.href;
                    var ur = new URL(u);
        var aid = ur.searchParams.get("aid");
        var bid = ur.searchParams.get("bid");
        var cid = ur.searchParams.get("cid");

        document.getElementById("via").href="commsum.html?aid="+aid+"&bid="+bid+"&cid="+cid+"&frm=commision";


});
                     
 
 </script>
  </body>
</html>